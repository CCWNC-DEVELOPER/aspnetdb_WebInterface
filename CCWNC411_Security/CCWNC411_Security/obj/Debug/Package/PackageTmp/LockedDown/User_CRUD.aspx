<%@ Page Title="" Language="vb" AutoEventWireup="false" MasterPageFile="~/Site.Master" CodeBehind="User_CRUD.aspx.vb" Inherits="CCWNC411_Security.User_CRUD"  %>
<asp:Content ID="Content1" ContentPlaceHolderID="HeadContent" runat="server">
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="MainContent" runat="server">


<%--  Object Data Sources ------------------------------------------------------------------------ --%>


<%--  ODS for the DropDownList --%>
   <p>
        <asp:SqlDataSource ID="SqlDataSource_DropDownList" runat="server" 
            ConnectionString="<%$ ConnectionStrings:SHAREPOINT01_aspnetdb %>"        
            ProviderName="<%$ ConnectionStrings:SHAREPOINT01_aspnetdb.ProviderName %>" 
            SelectCommand="SELECT [ApplicationName], [ApplicationId] FROM [aspnet_Applications]" >
        </asp:SqlDataSource>

    </p>
<%--  ODS for the  GridView --%>
    <p>
          <asp:ObjectDataSource 
            ID="ods_GridView_Users" 
            runat="server" 
            TypeName="CCWNC411_Security.ns_USER.c_USER_DL" 
            DataObjectTypeName="CCWNC411_Security.ns_USER.c_USER_Record" 
            SelectMethod="GetAllUsers_GivenApplicationName" 
            OnSelecting="ods_GridView_Users_Selecting">
             <SelectParameters>
                <asp:QueryStringParameter Name="ApplicationName"
                    QueryStringField="ApplicationName" 
                     />
            </SelectParameters>
      </asp:ObjectDataSource>
    
    </p>
<%--  ODS for the  DetailsView --%>
    <p>
    
      <asp:ObjectDataSource 
        ID="ods_ViewDetails_User" 
        runat="server" 
        TypeName="CCWNC411_Security.ns_USER.c_USER_DL"
        DataObjectTypeName="CCWNC411_Security.ns_USER.c_USER_Record"
        SelectMethod="GetUser"
        InsertMethod="InsertUser"
        UpdateMethod="UpdateUser"
        DeleteMethod="DeleteUser"
        OnInserted="ods_ViewDetails_User_Inserted"
        OnUpdated="ods_ViewDetails_User_Updated"
        OnDeleted="ods_ViewDetails_User_Deleted"  
        OnSelecting="ods_ViewDetails_User_Selecting">
        <SelectParameters>
          <asp:Parameter Name="UserName" Type="String" />  
          <asp:Parameter Name="ApplicationName" Type="String" />  
        </SelectParameters>
      </asp:ObjectDataSource>
    </p>

   <p>

<%--  Controls ------------------------------------------------- --%>

    <p>
        <asp:Label ID="lbl_Message" runat="server" Text="Label"></asp:Label>
        
    </p>
    <p>

        <asp:Button ID="btn_ListUsersForSelectedApplication" runat="server" 
            Text="List the users associated with the Web Site" Width="309px" />
    </p>


<%--  Controls using ODS ------------------------------------------------- --%>


<%--  uses ODS: DropDownList --%>

<p>
        <asp:DropDownList 
            ID="DropDownList_Application" 
            runat="server" 
            AppendDataBoundItems="true"
            DataSourceID="SqlDataSource_DropDownList" 
            DataTextField="ApplicationName" 
            DataValueField="ApplicationName" 
            AutoPostBack="true">

        </asp:DropDownList>


</p>
<%--  uses ODS: GridView --%>
<p>
            <asp:GridView 
                  ID="GridView_UsersInApplication" 
                  DataSourceID="ods_GridView_Users" 
                  AutoGenerateColumns="false"
                  DataKeyNames="UserName" 
                  OnSelectedIndexChanged="GridView_UsersInApplication_SelectedIndexChanged"
                  RunAt="server">

              <HeaderStyle backcolor="lightblue" forecolor="black"/>

              <Columns>                
                <asp:ButtonField Text="Details..."
                                 HeaderText="Show Details"
                                 CommandName="Select"/>  

                <asp:BoundField DataField="UserName"  HeaderText="UserName" SortExpression="UserName" />
                <asp:BoundField DataField="IsApproved"   HeaderText="IsApproved" SortExpression="IsApproved" />  
                <asp:BoundField DataField="IsLockedOut"   HeaderText="IsLockedOut" SortExpression="IsLockedOut" />                 
                <asp:BoundField DataField="LastActivityDate"   HeaderText="LastActivityDate" SortExpression="LastActivityDate" />                                      
              </Columns>                
            </asp:GridView> 
</p>
<%--  uses ODS: DetailsView --%>
<p>

            <asp:DetailsView ID="DetailsView_User"
              DataSourceID="ods_ViewDetails_User"
              AutoGenerateRows="False"
              EmptyDataText="No records."      
              DataKeyNames="UserName,ApplicationName" 
              AutoGenerateInsertButton="True"
              AutoGenerateEditButton="True"
              AutoGenerateDeleteButton="True"
              OnItemInserted="DetailsView_User_ItemInserted"
              OnItemUpdated="DetailsView_User_ItemUpdated"
              OnItemDeleted="DetailsView_User_ItemDeleted" 
              RunAt="server">

              <HeaderStyle backcolor="Navy" forecolor="White"/>

              <RowStyle backcolor="White"/>

              <AlternatingRowStyle backcolor="LightGray"/>

              <EditRowStyle backcolor="LightCyan"/>

              <Fields>      
                    <asp:TemplateField HeaderText="ApplicationName">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox1" runat="server" Text='<%# Bind("ApplicationName") %>' ReadOnly="true" BackColor="LightGray" ></asp:TextBox>
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox1" runat="server" Text='<%# Bind("ApplicationName") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label1" runat="server" Text='<%# Bind("ApplicationName") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>
                    <asp:TemplateField HeaderText="UserName">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox2" runat="server" Text='<%# Bind("UserName") %>' ReadOnly="true" BackColor="LightGray"></asp:TextBox>
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox2" runat="server" Text='<%# Bind("UserName") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label2" runat="server" Text='<%# Bind("UserName") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>
                    <asp:TemplateField HeaderText="Password">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox3" runat="server" Text='<%# Bind("Password") %>'></asp:TextBox>
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox3" runat="server" Text='<%# Bind("Password") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label3" runat="server" Text='<%# Bind("Password") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>
                    <asp:TemplateField HeaderText="PasswordSalt">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox4" runat="server" Text='<%# Bind("PasswordSalt") %>' ReadOnly="true" BackColor="LightGray"></asp:TextBox>
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox4" runat="server" Text='<%# Bind("PasswordSalt") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label4" runat="server" Text='<%# Bind("PasswordSalt") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>
                    <asp:TemplateField HeaderText="Email">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox5" runat="server" Text='<%# Bind("Email") %>' ReadOnly="true" BackColor="LightGray"></asp:TextBox>
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox5" runat="server" Text='<%# Bind("Email") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label5" runat="server" Text='<%# Bind("Email") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>
                    <asp:TemplateField HeaderText="PasswordQuestion">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox6" runat="server" 
                                Text='<%# Bind("PasswordQuestion") %>' ReadOnly="true" BackColor="LightGray"></asp:TextBox>
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox6" runat="server" 
                                Text='<%# Bind("PasswordQuestion") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label6" runat="server" Text='<%# Bind("PasswordQuestion") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>
                    <asp:TemplateField HeaderText="PasswordAnswer">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox7" runat="server" Text='<%# Bind("PasswordAnswer") %>' ReadOnly="true" BackColor="LightGray"></asp:TextBox>
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox7" runat="server" Text='<%# Bind("PasswordAnswer") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label7" runat="server" Text='<%# Bind("PasswordAnswer") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>
                    <asp:TemplateField HeaderText="IsApproved">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox8" runat="server" Text='<%# Bind("IsApproved") %>' ReadOnly="true" BackColor="LightGray"></asp:TextBox>
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox8" runat="server" Text='<%# Bind("IsApproved") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label8" runat="server" Text='<%# Bind("IsApproved") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>

                    <asp:TemplateField HeaderText="CurrentTimeUtc">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox9" runat="server" Text='<%# Bind("CurrentTimeUtc") %>' ReadOnly="true" BackColor="LightGray"></asp:TextBox> 
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox9" runat="server" Text='<%# Bind("CurrentTimeUtc") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label9" runat="server" Text='<%# Bind("CurrentTimeUtc") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>


                    <asp:TemplateField HeaderText="CreateDate">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox10" runat="server" Text='<%# Bind("CreateDate") %>' ReadOnly="true" BackColor="LightGray"></asp:TextBox>
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox10" runat="server" Text='<%# Bind("CreateDate") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label10" runat="server" Text='<%# Bind("CreateDate") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>
                    <asp:TemplateField HeaderText="UniqueEmail">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox11" runat="server" Text='<%# Bind("UniqueEmail") %>' ReadOnly="true" BackColor="LightGray"></asp:TextBox>
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox11" runat="server" Text='<%# Bind("UniqueEmail") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label11" runat="server" Text='<%# Bind("UniqueEmail") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>
                    <asp:TemplateField HeaderText="PasswordFormat">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox12" runat="server" Text='<%# Bind("PasswordFormat") %>' ReadOnly="true" BackColor="LightGray"></asp:TextBox>
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox12" runat="server" Text='<%# Bind("PasswordFormat") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label12" runat="server" Text='<%# Bind("PasswordFormat") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>
                    <asp:TemplateField HeaderText="UserID" InsertVisible="False">
                        <EditItemTemplate>
                            <asp:Label ID="Label1" runat="server" Text='<%# Eval("UserID") %>'></asp:Label>
                        </EditItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label13" runat="server" Text='<%# Bind("UserID") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>
                    <asp:TemplateField HeaderText="IsLockedOut">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox13" runat="server" Text='<%# Bind("IsLockedOut") %>' ReadOnly="true" BackColor="LightGray"></asp:TextBox>
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox13" runat="server" Text='<%# Bind("IsLockedOut") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label14" runat="server" Text='<%# Bind("IsLockedOut") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>
                    <asp:TemplateField HeaderText="LastLoginDate">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox14" runat="server" Text='<%# Bind("LastLoginDate") %>' ReadOnly="true" BackColor="LightGray"></asp:TextBox>
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox14" runat="server" Text='<%# Bind("LastLoginDate") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label15" runat="server" Text='<%# Bind("LastLoginDate") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>
                    <asp:TemplateField HeaderText="LastActivityDate">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox15" runat="server" 
                                Text='<%# Bind("LastActivityDate") %>' ReadOnly="true" BackColor="LightGray"></asp:TextBox>
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox15" runat="server" 
                                Text='<%# Bind("LastActivityDate") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label16" runat="server" Text='<%# Bind("LastActivityDate") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>
                    <asp:TemplateField HeaderText="ApplicationId">
                        <EditItemTemplate>
                            <asp:TextBox ID="TextBox16" runat="server" Text='<%# Bind("ApplicationId") %>' ReadOnly="true" BackColor="LightGray"></asp:TextBox>
                        </EditItemTemplate>
                        <InsertItemTemplate>
                            <asp:TextBox ID="TextBox16" runat="server" Text='<%# Bind("ApplicationId") %>'></asp:TextBox>
                        </InsertItemTemplate>
                        <ItemTemplate>
                            <asp:Label ID="Label17" runat="server" Text='<%# Bind("ApplicationId") %>'></asp:Label>
                        </ItemTemplate>
                    </asp:TemplateField>
      
               </Fields>                    
            </asp:DetailsView>

</p>

</asp:Content>
